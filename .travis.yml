sudo: required
dist: trusty
language: cpp

cache:
  directories:
    - deps

matrix:
  include:
    - compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
            - gcc-5
      env:
        - CONFIG=debug
        - CONFDIR=Debug
        - COMPILER=gcc
        - VALGRIND=valgrind --tool=memcheck --leak-check=yes --show-reachable=yes --num-callers=20 --track-fds=yes
    - compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
            - gcc-5
      env:
        - CONFIG=release
        - CONFDIR=Release
        - COMPILER=gcc
        - VALGRIND=""

before_install:
  - export CC=gcc-5
  - export CXX=g++-5
  - sudo apt-get update -qq
  - sudo apt-get install -y unzip openjdk-7-jdk git uuid-dev valgrind
  - bash ./install-travis-deps.sh

before_script:
  - cp environment.travis.lua environment.lua
  - premake5 gmake
  - make config=$CONFIG all

script:
  - LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$(pwd)/deps/antlr4/runtime/Cpp/dist" $VALGRIND ./bin/$CONFDIR/testimq
